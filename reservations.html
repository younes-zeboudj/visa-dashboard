<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <script
      type="text/javascript"
      charset="utf-8"
      src="bk.js
    "
    ></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>

    <link
      href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.6/bootstrap-editable/css/bootstrap-editable.css"
      rel="stylesheet"
    />
    <script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.4.6/bootstrap-editable/js/bootstrap-editable.min.js"></script>
  </head>
  <style>
    .table > tbody > tr > td {
      vertical-align: middle;
    }
  </style>
  <body>
    <div style="text-align: center;"><p>click the email/passowrd to copy</p></div>
    <table class="table table-striped table-dark">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">Password</th>
          <th scope="col">Client</th>
          <th scope="col">Type</th>
          <th scope="col">Date reserved</th>
          <th scope="col">Card</th>
          <th scope="col">Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      function copyToClipboard(element) {
        $(element).blink();

        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val($(element).text()).select();
        document.execCommand("copy");
        $temp.remove();
      }

      function get_passps() {
        $.ajax(
          "https://passport-success-default-rtdb.europe-west1.firebasedatabase.app/.json",
          {
            method: "get",

            success: (clientsdata, text, xhr) => {
              let i = 1;
              $("tbody").html("");
              for (const clientid in clientsdata) {
                const data = clientsdata[clientid];
                for (const id in data) {
                  $("tbody").append(`
                      <tr>
          <th scope="row">${i++}</th>
          <td>${data[id].customers[0].FirstName} ${
                    data[id].customers[0].LastName
                  }</td>
                        <td style="color:wheat;text-align:center;cursor:pointer" onclick='copyToClipboard(this)'>${
                          data[id].EmailId
                        }</td>
                        <td style="color:wheat;text-align:center;cursor:pointer" onclick='copyToClipboard(this)'>${
                          data[id].Password
                        }</td>

          <td>${data[id].user || data[id].client}</td>
          <td>${data[id].VisaCategoryId}</td>
          <td>${data[id].reservaion_date}</td>
          <td>${data[id].cib?.PAN} ${data[id].cib?.TEXT}</td>
          <td>
              <button onclick='remove("${clientid}/${id}")' class='btn btn-secondary'>remove</button>
          </td>
      </tr>

                      `);
                }
              }
            },
            error: (xhr, text, error) => {
              console.log(error);
            },
          }
        );
      }
      setInterval(get_passps, 3000);
      get_passps();

      function add_card_clicked() {
        const card = {};
        card.PAN = document.querySelector("[name='PAN']").value;
        card.CVC = document.querySelector("[name='CVC']").value;
        card.MM = document.querySelector("[name='MM']").value;
        card.YYYY = document.querySelector("[name='YYYY']").value;
        card.TEXT = document.querySelector("[name='TEXT']").value;

        if (card.PAN.length != 16) return alert("incorrect card number");
        if (card.CVC.length != 3) return alert("incorrect card cvc");
        if (card.TEXT.length == 0) return alert("empty name");

        add(card.PAN, card);
      }

      function remove(id) {
        $.ajax(
          `https://passport-success-default-rtdb.europe-west1.firebasedatabase.app/${id}.json`,
          { method: "delete", success: () => get_passps() }
        );
      }
    </script>
  </body>
</html>
<!-- <tr>
    <th scope="row">1</th>
    <td>Mark</td>
    <td>Otto</td>
    <td>@mdo</td>
  </tr>
  <tr>
    <th scope="row">2</th>
    <td>Jacob</td>
    <td>Thornton</td>
    <td>@fat</td>
  </tr>
  <tr>
    <th scope="row">3</th>
    <td>Larry</td>
    <td>the Bird</td>
    <td>@twitter</td>
  </tr> -->
